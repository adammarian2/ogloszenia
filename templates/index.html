<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Wykres ogłoszeń</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <h1>Ogłoszenia OLX i Otodom</h1>

    <form method="get" action="/">
        <label for="city">Wybierz miasto:</label>
        <select name="city" id="city" onchange="this.form.submit()">
            {% for city in cities %}
                <option value="{{ city }}" {% if city == selected_city %}selected{% endif %}>{{ city }}</option>
            {% endfor %}
        </select>
    </form>

    <h2>Wykres OLX</h2>
    <canvas id="olxChart" height="100"></canvas>

    <h2>Wykres Otodom</h2>
    <canvas id="otodomChart" height="100"></canvas>

    <h2>Suma OLX + Otodom</h2>
    <canvas id="sumChart" height="100"></canvas>

    <script>
        const labels = {{ dates|tojson }};
        const olxData = {{ olx_counts|tojson }};
        const otodomData = {{ otodom_counts|tojson }};
        const totalData = {{ total_counts|tojson }};

        new Chart(document.getElementById('olxChart').getContext('2d'), {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: 'OLX',
                    data: olxData,
                    borderColor: 'green',
                    fill: false
                }]
            },
            options: {
                scales: { y: { grid: { display: false } } }
            }
        });

        new Chart(document.getElementById('otodomChart').getContext('2d'), {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Otodom',
                    data: otodomData,
                    borderColor: 'blue',
                    fill: false
                }]
            },
            options: {
                scales: { y: { grid: { display: false } } }
            }
        });

        new Chart(document.getElementById('sumChart').getContext('2d'), {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Suma',
                    data: totalData,
                    borderColor: 'magenta',
                    fill: false
                }]
            },
            options: {
                scales: { y: { grid: { display: false } } }
            }
        });
    </script>
</body>
</html>
